<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>VOD ì˜êµ¬ì €ì¥ í”„ë¡œí† íƒ€ì… v2</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:-apple-system,'Malgun Gothic','Noto Sans KR',sans-serif;background:#f5f5f8;color:#333;font-size:13px;}
  .layout{display:flex;min-height:100vh;}
  .sidebar{width:190px;background:#1B1D29;color:#aab;flex-shrink:0;padding-top:16px;}
  .sidebar .logo{padding:0 16px 14px;border-bottom:1px solid #2a2d3a;margin-bottom:6px;}
  .sidebar .logo b{color:#fff;font-size:14px;}
  .sidebar .logo small{display:block;color:#667;font-size:10px;margin-top:2px;}
  .nav-item{padding:8px 16px 8px 22px;cursor:pointer;display:flex;align-items:center;gap:7px;color:#99a;font-size:12px;transition:.15s;}
  .nav-item:hover{background:#252838;color:#ccd;}
  .nav-item.active{background:#2a2d42;color:#fff;border-right:3px solid #4F6AFF;}
  .nav-item.sub{padding-left:38px;font-size:11px;}
  .nav-item.sub.active{color:#4F6AFF;font-weight:600;background:#2a2d42;}
  .nav-item.new-badge::after{content:"NEW";font-size:9px;background:#FF4D4F;color:#fff;padding:1px 5px;border-radius:3px;margin-left:auto;font-weight:700;}
  .main{flex:1;overflow-x:auto;}
  .topbar{background:#fff;border-bottom:1px solid #e5e7eb;padding:10px 24px;display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#888;}
  .topbar b{color:#333;}
  .content{padding:20px 24px;}
  .tabs{display:flex;gap:0;border-bottom:2px solid #e5e7eb;margin-bottom:16px;}
  .tab{padding:9px 20px;cursor:pointer;font-size:12px;color:#888;font-weight:500;border-bottom:2px solid transparent;margin-bottom:-2px;transition:.15s;}
  .tab:hover{color:#555;}
  .tab.active{color:#4F6AFF;border-bottom-color:#4F6AFF;font-weight:700;}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:14px;}
  .filter-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:12px;}
  .filter-row select,.filter-row input{padding:6px 10px;border:1px solid #ddd;border-radius:5px;font-size:11px;outline:none;}
  .filter-row select:focus,.filter-row input:focus{border-color:#4F6AFF;}
  .filter-row input{width:200px;}
  table{width:100%;border-collapse:collapse;}
  thead th{background:#F8F9FB;padding:9px 10px;text-align:left;font-size:10px;color:#666;font-weight:600;border-bottom:1px solid #e5e7eb;white-space:nowrap;}
  tbody td{padding:10px 10px;border-bottom:1px solid #f0f0f3;font-size:11px;vertical-align:middle;}
  tbody tr:hover{background:#FAFAFF;}
  .perm-btn{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid;transition:.15s;}
  .perm-btn.normal{background:#F9FAFB;color:#9CA3AF;border-color:#E5E7EB;}
  .perm-btn.normal:hover{background:#F3F4F6;border-color:#D1D5DB;color:#6B7280;}
  .perm-btn.saved{background:#EEF2FF;color:#4F46E5;border-color:#C7D2FE;}
  .perm-btn.saved:hover{background:#E0E7FF;border-color:#A5B4FC;}
  .badge{display:inline-block;padding:2px 7px;border-radius:3px;font-size:10px;font-weight:600;}
  .badge-public{background:#ECFDF5;color:#059669;}
  .badge-vod{background:#FFF7ED;color:#C2410C;}
  .badge-live-vod{background:#F0F9FF;color:#0369A1;}
  .badge-shorts{background:#F5F3FF;color:#7C3AED;}
  .stats-row{display:flex;gap:12px;margin-bottom:16px;}
  .stat-card{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:12px 18px;min-width:140px;flex:1;max-width:200px;}
  .stat-label{font-size:10px;color:#888;margin-bottom:3px;}
  .stat-value{font-size:20px;font-weight:800;color:#333;}
  .stat-value .unit{font-size:11px;color:#aaa;font-weight:500;}
  .stat-card.hl{border-color:#C7D2FE;background:#FAFAFF;}
  .stat-card.hl .stat-value{color:#4F46E5;}
  .warn-box{background:#FFFBEB;border:1px solid #FDE68A;border-radius:7px;padding:10px 14px;font-size:11px;color:#92400E;line-height:1.6;display:flex;gap:6px;margin-bottom:14px;}
  .text-muted{color:#999;font-size:10px;}
  .btn{padding:6px 14px;border:none;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;transition:.15s;display:inline-flex;align-items:center;gap:4px;}
  .btn-primary{background:#4F6AFF;color:#fff;}
  .btn-primary:hover{background:#3D55DB;}
  .btn-outline{background:#fff;color:#555;border:1px solid #ddd;}
  .btn-outline:hover{background:#f9f9fb;border-color:#bbb;}
  .btn-danger{background:#FF4D4F;color:#fff;}
  .btn-danger:hover{background:#D9363E;}
  .btn-sm{padding:4px 9px;font-size:10px;}
  .chk{width:15px;height:15px;accent-color:#4F6AFF;cursor:pointer;}
  .empty{text-align:center;padding:40px;color:#bbb;font-size:12px;}

  /* ID ì…ë ¥ ì˜ì—­ */
  .id-input-card{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:18px 20px;margin-bottom:14px;border-left:4px solid #4F6AFF;}
  .id-input-card .card-title{font-size:13px;font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:6px;}
  .id-input-card .card-desc{font-size:11px;color:#888;margin-bottom:14px;line-height:1.6;}
  .id-input-row{display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap;}
  .field-group{display:flex;flex-direction:column;gap:3px;}
  .field-group label{font-size:10px;color:#666;font-weight:600;}
  .field-group input{padding:7px 11px;border:1px solid #ddd;border-radius:5px;font-size:12px;outline:none;min-width:200px;}
  .field-group input:focus{border-color:#4F6AFF;}
  .field-group input::placeholder{color:#bbb;}

  /* ì˜êµ¬ì €ì¥ ID ë±ƒì§€ */
  .perm-id-badge{display:inline-block;background:#DBEAFE;color:#1E40AF;font-size:9px;padding:2px 6px;border-radius:3px;font-weight:600;font-family:monospace;margin-top:2px;}

  /* Modal */
  .modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:1000;justify-content:center;align-items:center;}
  .modal-bg.show{display:flex;}
  .modal{background:#fff;border-radius:12px;padding:24px;width:420px;max-width:90vw;box-shadow:0 16px 48px rgba(0,0,0,.2);}
  .modal h3{font-size:15px;margin-bottom:5px;}
  .modal .desc{font-size:11px;color:#888;margin-bottom:14px;line-height:1.6;}
  .modal .info-box{background:#F8F9FB;border:1px solid #eee;border-radius:6px;padding:10px 12px;font-size:11px;margin-bottom:14px;line-height:1.6;}
  .modal .info-box b{color:#333;}
  .modal .actions{display:flex;gap:6px;justify-content:flex-end;margin-top:16px;}
  .modal .actions .btn-cancel{background:#F3F4F6;color:#555;border:none;padding:8px 18px;border-radius:6px;cursor:pointer;font-size:12px;}
  .modal .actions .btn-confirm{padding:8px 18px;border-radius:6px;border:none;color:#fff;cursor:pointer;font-size:12px;font-weight:600;}
  .modal .actions .btn-confirm.blue{background:#4F6AFF;}
  .modal .actions .btn-confirm.blue:hover{background:#3D55DB;}
  .modal .actions .btn-confirm.red{background:#FF4D4F;}
  .modal .actions .btn-confirm.red:hover{background:#D9363E;}
  .modal .retention-info{background:#FFF7ED;border:1px solid #FDE68A;border-radius:6px;padding:10px;font-size:11px;color:#92400E;margin-top:10px;line-height:1.6;}
  .modal .id-result{background:#F0F9FF;border:1px solid #BAE6FD;border-radius:6px;padding:10px;font-size:11px;color:#0369A1;margin-top:10px;line-height:1.6;}
  .toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);padding:10px 24px;background:#1B1D29;color:#fff;border-radius:7px;font-size:12px;font-weight:500;z-index:2000;display:none;box-shadow:0 6px 24px rgba(0,0,0,.3);}
  .toast.show{display:block;animation:ti .3s ease;}
  @keyframes ti{from{opacity:0;transform:translateX(-50%) translateY(8px);}to{opacity:1;transform:translateX(-50%) translateY(0);}}
</style>
</head>
<body>
<div class="layout">
  <div class="sidebar">
    <div class="logo"><b>Grip</b> ê´€ë¦¬ìì„¼í„°<small>ì¹˜ì¦ˆì•„ë¹ 2 Â· yongha</small></div>
    <div class="nav-item">ğŸ‘¤ ì´ìš©ì ê´€ë¦¬</div>
    <div class="nav-item">ğŸ’¬ ë¬¸ì˜ ê´€ë¦¬</div>
    <div class="nav-item active">ğŸ“º ë°©ì†¡ ê´€ë¦¬</div>
    <div class="nav-item sub" id="nav-all" onclick="go('all')" style="color:#fff;background:#2a2d42;">ì „ì²´ ë°©ì†¡</div>
    <div class="nav-item sub new-badge" id="nav-perm" onclick="go('perm')">ğŸ”’ ì˜êµ¬ì €ì¥ ëª©ë¡</div>
    <div class="nav-item sub">ì œì™¸ëœ ë°©ì†¡</div>
    <div class="nav-item sub">ì‚­ì œëœ ë°©ì†¡</div>
    <div class="nav-item sub">ë°©ì†¡ íŒ€</div>
    <div class="nav-item">ğŸ›’ ì‡¼í•‘ ê´€ë¦¬</div>
    <div class="nav-item">ğŸ“¦ ì£¼ë¬¸ ê´€ë¦¬</div>
    <div class="nav-item">ğŸ’° ì •ì‚° ê´€ë¦¬</div>
  </div>

  <div class="main">
    <div class="topbar">
      <div>ë°©ì†¡ ê´€ë¦¬ &gt; <b id="pageTitle">ì „ì²´ ë°©ì†¡</b></div>
      <div>ìŠˆí¼ì…€ëŸ¬ ëŒ€ì‹œë³´ë“œ &nbsp; ê°€ì´ë“œ</div>
    </div>
    <div class="content">

      <!-- ===== PAGE: ì „ì²´ ë°©ì†¡ ===== -->
      <div id="pg-all">
        <div class="tabs">
          <div class="tab" onclick="setTab('all')">ì „ì²´</div>
          <div class="tab" onclick="setTab('live')">LIVE</div>
          <div class="tab active" id="tab-livevod" onclick="setTab('livevod')">LIVE VOD</div>
          <div class="tab" id="tab-vod" onclick="setTab('vod')">VOD</div>
        </div>
        <div class="filter-row">
          <select><option>ê³µê°œ ì¼ì‹œ</option></select>
          <select><option>ë‹´ë‹¹MD</option></select>
          <input placeholder="ë°©ì†¡ì / ì œëª© ê²€ìƒ‰..." id="searchAll" oninput="renderAll()">
          <div style="flex:1"></div>
          <button class="btn btn-outline btn-sm">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>
        <div class="card" style="padding:0;overflow:hidden;">
          <table>
            <thead><tr id="allHead"></tr></thead>
            <tbody id="tbAll"></tbody>
          </table>
        </div>
        <div style="font-size:11px;color:#aaa;text-align:center;padding:6px;">20ê°œì”© ë³´ê¸° &nbsp; 78ê°œ ì¤‘ 1~20</div>
      </div>

      <!-- ===== PAGE: ì˜êµ¬ì €ì¥ ëª©ë¡ ===== -->
      <div id="pg-perm" style="display:none;">
        <div class="tabs"><div class="tab active">ì˜êµ¬ì €ì¥ ëª©ë¡</div></div>

        <!-- ID ì…ë ¥ ì˜êµ¬ì €ì¥ -->
        <div class="id-input-card">
          <div class="card-title">ğŸ”’ ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ ì„¤ì •</div>
          <div class="card-desc">
            IDë¥¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ IDì—ì„œ ë°œìƒí•˜ëŠ” <b>ëª¨ë“  VOD(LIVE VOD, VOD, ì‡¼ì¸ )</b>ê°€ ì˜êµ¬ì €ì¥ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
            ì´í›„ í•´ë‹¹ IDë¡œ ìƒˆë¡œ ìƒì„±ë˜ëŠ” VODë„ ìë™ìœ¼ë¡œ ì˜êµ¬ì €ì¥ë©ë‹ˆë‹¤.
          </div>
          <div class="id-input-row">
            <div class="field-group">
              <label>ì˜êµ¬ì €ì¥ ëŒ€ìƒ ID</label>
              <input type="text" id="permIdInput" placeholder="ì˜ˆ: seller_0042, broadcaster_id">
            </div>
            <button class="btn btn-primary" onclick="setPermById()">ğŸ”’ ì˜êµ¬ì €ì¥ ì„¤ì •</button>
            <button class="btn btn-danger" onclick="unsetPermById()">ğŸ”“ ì˜êµ¬ì €ì¥ í•´ì œ</button>
          </div>
          <div id="registeredIds" style="margin-top:12px;"></div>
        </div>

        <div class="stats-row">
          <div class="stat-card hl"><div class="stat-label">ì˜êµ¬ì €ì¥ VOD</div><div class="stat-value" id="stCnt">0<span class="unit">ê±´</span></div></div>
          <div class="stat-card"><div class="stat-label">ì˜êµ¬ì €ì¥ ID</div><div class="stat-value" id="stIdCnt">0<span class="unit">ê°œ</span></div></div>
          <div class="stat-card"><div class="stat-label">ì „ì²´ VOD ëŒ€ë¹„</div><div class="stat-value" id="stRatio">0<span class="unit">%</span></div></div>
        </div>

        <div class="warn-box">âš ï¸ ì˜êµ¬ì €ì¥ëœ VODëŠ” ìë™ ì‚­ì œ ì •ì±…(ì„œë¹„ìŠ¤ë…¸ì¶œ 6ê°œì›” + ë°±ë‹¨ ë³´ê´€ 6ê°œì›”)ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ì˜êµ¬ì €ì¥ì€ ìŠ¤í† ë¦¬ì§€ ë¹„ìš©ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

        <div class="filter-row">
          <select id="permIdFilter" onchange="renderPerm()" style="min-width:160px;">
            <option value="all">ì „ì²´ ID</option>
          </select>
          <select id="permTypeFilter" onchange="renderPerm()">
            <option value="all">ì „ì²´ êµ¬ë¶„</option>
            <option value="LIVE VOD">LIVE VOD</option>
            <option value="VOD">VOD</option>
            <option value="ì‡¼ì¸ ">ì‡¼ì¸ </option>
          </select>
          <input placeholder="ë°©ì†¡ë²ˆí˜¸ / ë°©ì†¡ì / ì œëª© ê²€ìƒ‰..." id="searchPerm" oninput="renderPerm()">
          <div style="flex:1"></div>
          <button class="btn btn-danger btn-sm" onclick="bulkRelease()">ğŸ”“ ì„ íƒ í•´ì œ</button>
          <button class="btn btn-outline btn-sm">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div class="card" style="padding:0;overflow:hidden;">
          <table>
            <thead><tr>
              <th><input type="checkbox" class="chk" id="ckAllPerm" onchange="togglePermAll(this)"></th>
              <th>ì˜êµ¬ì €ì¥ ID</th><th>ë°©ì†¡ë²ˆí˜¸</th><th>ë°©ì†¡ì</th><th>ë‹´ë‹¹MD</th><th>êµ¬ë¶„</th><th>ì œëª©</th>
              <th>ì €ì¥ ì¼ì‹œ</th><th>ê³µê°œ ì¼ì‹œ</th><th>ê¸°ëŠ¥</th>
            </tr></thead>
            <tbody id="tbPerm"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ì˜êµ¬ì €ì¥ ì„¤ì • ëª¨ë‹¬ (ê°œë³„) -->
<div class="modal-bg" id="mSet">
  <div class="modal">
    <h3>ğŸ”’ ì˜êµ¬ì €ì¥ ì²˜ë¦¬</h3>
    <p class="desc">í•´ë‹¹ VODë¥¼ ì˜êµ¬ì €ì¥ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <div class="info-box" id="mSetInfo"></div>
    <div style="font-size:11px;color:#666;line-height:1.6;">
      ì˜êµ¬ì €ì¥ ì‹œ ìë™ ì‚­ì œ ì •ì±…ì—ì„œ ì œì™¸ë˜ë©°,<br>ë³„ë„ í•´ì œ ì „ê¹Œì§€ ì˜êµ¬ì ìœ¼ë¡œ ë³´ê´€ë©ë‹ˆë‹¤.
    </div>
    <div class="actions">
      <button class="btn-cancel" onclick="closeM('mSet')">ì·¨ì†Œ</button>
      <button class="btn-confirm blue" onclick="confirmSet()">ì˜êµ¬ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ì˜êµ¬ì €ì¥ í•´ì œ ëª¨ë‹¬ (ê°œë³„) -->
<div class="modal-bg" id="mUnset">
  <div class="modal">
    <h3>ğŸ”“ ì˜êµ¬ì €ì¥ ì·¨ì†Œ</h3>
    <p class="desc">ì˜êµ¬ì €ì¥ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <div class="info-box" id="mUnsetInfo"></div>
    <div class="retention-info">
      âš ï¸ <b>í•´ì œ ì‹œ ë³´ê´€ ì •ì±… ì•ˆë‚´</b><br><br>
      Â· ê¸°ë³¸ ë³´ê´€ ê¸°ê°„: <b>ìµœëŒ€ 1ë…„</b> (ì„œë¹„ìŠ¤ë…¸ì¶œ 6ê°œì›” + ë°±ë‹¨ ë³´ê´€ 6ê°œì›”)<br>
      Â· í•´ì œ ì‹œì ë¶€í„° <b>6ê°œì›” í›„ ì„œë¹„ìŠ¤ ë…¸ì¶œ ì¢…ë£Œ</b>, ì´í›„ 6ê°œì›”ê°„ ë°±ë‹¨ ë³´ê´€ í›„ ì™„ì „ ì‚­ì œ<br>
      Â· ì‚­ì œëœ VODëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    </div>
    <div class="actions">
      <button class="btn-cancel" onclick="closeM('mUnset')">ì·¨ì†Œ</button>
      <button class="btn-confirm red" onclick="confirmUnset()">ì˜êµ¬ì €ì¥ í•´ì œ</button>
    </div>
  </div>
</div>

<!-- ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ ì„¤ì • ëª¨ë‹¬ -->
<div class="modal-bg" id="mIdSet">
  <div class="modal">
    <h3>ğŸ”’ ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ ì„¤ì •</h3>
    <p class="desc">í•´ë‹¹ IDì˜ ëª¨ë“  VODë¥¼ ì˜êµ¬ì €ì¥ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
    <div class="info-box" id="mIdSetInfo"></div>
    <div class="id-result" id="mIdSetResult"></div>
    <div style="font-size:11px;color:#666;line-height:1.6;margin-top:10px;">
      Â· í•´ë‹¹ IDì˜ ê¸°ì¡´ VOD(LIVE VOD, VOD, ì‡¼ì¸ ) ëª¨ë‘ ì˜êµ¬ì €ì¥<br>
      Â· ì´í›„ ìƒˆë¡œ ìƒì„±ë˜ëŠ” VODë„ ìë™ìœ¼ë¡œ ì˜êµ¬ì €ì¥ ì²˜ë¦¬
    </div>
    <div class="actions">
      <button class="btn-cancel" onclick="closeM('mIdSet')">ì·¨ì†Œ</button>
      <button class="btn-confirm blue" onclick="confirmIdSet()">ì¼ê´„ ì˜êµ¬ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ í•´ì œ ëª¨ë‹¬ -->
<div class="modal-bg" id="mIdUnset">
  <div class="modal">
    <h3>ğŸ”“ ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ í•´ì œ</h3>
    <p class="desc">í•´ë‹¹ IDì˜ ì˜êµ¬ì €ì¥ì„ í•´ì œí•©ë‹ˆë‹¤.</p>
    <div class="info-box" id="mIdUnsetInfo"></div>
    <div class="retention-info">
      âš ï¸ <b>í•´ì œ ì‹œ ë³´ê´€ ì •ì±… ì•ˆë‚´</b><br><br>
      Â· í•´ë‹¹ IDì˜ ëª¨ë“  VOD(LIVE VOD, VOD, ì‡¼ì¸ )ì— ê¸°ë³¸ ë³´ê´€ ì •ì±… ì¬ì ìš©<br>
      Â· í•´ì œ ì‹œì ë¶€í„° <b>6ê°œì›” í›„ ì„œë¹„ìŠ¤ ë…¸ì¶œ ì¢…ë£Œ</b><br>
      Â· ì´í›„ 6ê°œì›”ê°„ ë°±ë‹¨ ë³´ê´€ í›„ ì™„ì „ ì‚­ì œ<br>
      Â· ì´í›„ ìƒˆë¡œ ìƒì„±ë˜ëŠ” VODë„ ê¸°ë³¸ ì •ì±… ì ìš©
    </div>
    <div class="actions">
      <button class="btn-cancel" onclick="closeM('mIdUnset')">ì·¨ì†Œ</button>
      <button class="btn-confirm red" onclick="confirmIdUnset()">ì¼ê´„ í•´ì œ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let curTab='livevod', actionTarget=null, pendingPermId='', permChecked=new Set();

// ë“±ë¡ëœ ì˜êµ¬ì €ì¥ ID ëª©ë¡
let registeredPermIds = ["seller_0042"];

const D=[
  {id:"2018881",code:"owjpivl9",bc:"ìœ¤ì‹ í¬ [Yunbon ìœ¤ë³¸]",sellerId:"seller_0042",md:"",type:"LIVE VOD",st:"ê³µê°œì¤‘",title:"ê°€ê²© ì˜¤ë¥´ê¸°ì „ ë§ˆì§€ë§‰ ê³µë™êµ¬ë§¤",date:"2026-02-26 16:41",perm:true,permId:"seller_0042",permDate:"2026-02-20 10:00"},
  {id:"2018816",code:"ovevq8r3",bc:"[ë§¤ë‹ˆì‚¬ë‘ë‹ˆë¼ì‚¬ë‘]",sellerId:"seller_0099",md:"",type:"VOD",st:"ê³µê°œì¤‘",title:"ì•ˆë…• ì•ˆë…• ì•ˆë…• ì•ˆë…•",date:"2026-02-26 15:12",perm:false,permId:null,permDate:null},
  {id:"2018485",code:"o1gkq5wo",bc:"ìœ¤ì‹ í¬ [Yunbon ìœ¤ë³¸]",sellerId:"seller_0042",md:"",type:"LIVE VOD",st:"ê³µê°œì¤‘",title:"ë„ë„ë„ë¥´ë³´ë–¼ ë‚˜ë„ ëª¨ê³  ì‹¶ì–´...",date:"2026-02-25 23:03",perm:true,permId:"seller_0042",permDate:"2026-02-20 10:00"},
  {id:"2018015",code:"3x85q7qo",bc:"[ì‹¬ì‹¬í–‡]",sellerId:"seller_0077",md:"ê·¸ë¦½ ì…ì  MD",type:"VOD",st:"ê³µê°œì¤‘",title:"í†¡ í„°ì§€ëŠ” ìƒˆì½¤ë‹¬ì½¤ ë£¨ë¹„ë¹›í† ë§ˆí† ",date:"2026-02-25 17:00",perm:true,permId:"seller_0077",permDate:"2026-02-18 14:00"},
  {id:"2017978",code:"97rzmvv3",bc:"[ì‹¬ì‹¬í–‡]",sellerId:"seller_0077",md:"ê·¸ë¦½ ì…ì  MD",type:"VOD",st:"ê³µê°œì¤‘",title:"íƒœìš°ì§€ ì•Šì•„ ê¹”ë”í•œ ì €ì˜¨ë‹´ì  ì°¸ê¸°ë¦„",date:"2026-02-25 17:00",perm:true,permId:"seller_0077",permDate:"2026-02-18 14:00"},
  {id:"2016228",code:"32gmpj1o",bc:"[ì‹¬ì‹¬í–‡]",sellerId:"seller_0077",md:"ê·¸ë¦½ ì…ì  MD",type:"LIVE VOD",st:"ê³µê°œì¤‘",title:"íƒ±ê¸€í•œ ì‚´ë°œ ê°€ë“ ëŒ€ë¬¼ ë¯¼ë¬¼ì¥ì–´",date:"2026-02-23 14:00",perm:true,permId:"seller_0077",permDate:"2026-02-18 14:00"},
  {id:"2015880",code:"3yr1665o",bc:"ìœ¤ì‹ í¬ [Yunbon ìœ¤ë³¸]",sellerId:"seller_0042",md:"",type:"VOD",st:"ê³µê°œì¤‘",title:"í¬ì˜¬ë¼ì¸ x ìœ¤ë³¸ ì—ì‚¬ë¹„ ë°”ì´íŠ¸",date:"2026-02-22 23:33",perm:true,permId:"seller_0042",permDate:"2026-02-20 10:00"},
  {id:"2015138",code:"9n04xqvo",bc:"[ì‹¬ì‹¬í–‡]",sellerId:"seller_0077",md:"ê·¸ë¦½ ì…ì  MD",type:"ì‡¼ì¸ ",st:"ê³µê°œì¤‘",title:"í¬ìŠ¬í¬ìŠ¬ ì§„ì§œ ë°¤ê³ êµ¬ë§ˆ ë§› 30ì´ˆ",date:"2026-02-21 14:00",perm:true,permId:"seller_0077",permDate:"2026-02-18 14:00"},
  {id:"2015147",code:"9z04wqyo",bc:"ìœ¤ì‹ í¬ [Yunbon ìœ¤ë³¸]",sellerId:"seller_0042",md:"",type:"ì‡¼ì¸ ",st:"ê³µê°œì¤‘",title:"í”Œë¦¬ë§ˆì¼“ í­íƒ„ í•˜ì´ë¼ì´íŠ¸",date:"2026-02-21 13:28",perm:true,permId:"seller_0042",permDate:"2026-02-20 10:00"},
  {id:"2014995",code:"9z04w0vo",bc:"[DIY ì•„íŠ¸ë¦­]",sellerId:"seller_0111",md:"ê·¸ë¦½ ì…ì  MD",type:"VOD",st:"ê³µê°œì¤‘",title:"ë™ì˜ìƒ ìŠ¤í† ì–´ ê¿€ì˜ ë°©ë²• & ì•„í¬ë¦´",date:"2026-02-21 01:57",perm:false,permId:null,permDate:null},
  {id:"2014284",code:"94d1v7k9",bc:"ìœ¤ì‹ í¬ [Yunbon ìœ¤ë³¸]",sellerId:"seller_0042",md:"ê¹€ìœ ì›",type:"LIVE VOD",st:"ê³µê°œì¤‘",title:"ì˜ì–‘ë°€í”„ë¡œì íŠ¸ ë‹¤ì´ì–´íŠ¸ í´ë Œì¦ˆ",date:"2026-02-19 23:48",perm:true,permId:"seller_0042",permDate:"2026-02-20 10:00"},
  {id:"2014273",code:"9rj7q47o",bc:"[ì‹¬ì‹¬í–‡]",sellerId:"seller_0077",md:"ê·¸ë¦½ ì…ì  MD",type:"ì‡¼ì¸ ",st:"ê³µê°œì¤‘",title:"ë¨¸ë¦¬ë‚˜ì˜ ì œê±°í•œ ì†ì§ˆ ê½ƒì¹˜ 15ì´ˆ",date:"2026-02-19 23:00",perm:true,permId:"seller_0077",permDate:"2026-02-18 14:00"},
];

function setTab(t){
  curTab=t;
  document.querySelectorAll('#pg-all .tab').forEach(el=>el.classList.remove('active'));
  if(t==='all') document.querySelectorAll('#pg-all .tab')[0].classList.add('active');
  else if(t==='live') document.querySelectorAll('#pg-all .tab')[1].classList.add('active');
  else if(t==='livevod') document.getElementById('tab-livevod').classList.add('active');
  else document.getElementById('tab-vod').classList.add('active');
  renderAll();
}

function go(p){
  document.getElementById('pg-all').style.display=p==='all'?'':'none';
  document.getElementById('pg-perm').style.display=p==='perm'?'':'none';
  document.getElementById('pageTitle').textContent=p==='all'?'ì „ì²´ ë°©ì†¡':'ì˜êµ¬ì €ì¥ ëª©ë¡';
  document.getElementById('nav-all').style.color=p==='all'?'#fff':'';
  document.getElementById('nav-all').style.background=p==='all'?'#2a2d42':'';
  document.getElementById('nav-perm').style.color=p==='perm'?'#4F6AFF':'';
  document.getElementById('nav-perm').style.background=p==='perm'?'#2a2d42':'';
  if(p==='perm'){renderPerm();updStats();renderRegisteredIds();updPermIdFilter();}
  else renderAll();
}

function showPermCol(){return curTab==='livevod'||curTab==='vod';}

function getTypeBadge(t){
  if(t==='VOD') return 'badge-vod';
  if(t==='LIVE VOD') return 'badge-live-vod';
  if(t==='ì‡¼ì¸ ') return 'badge-shorts';
  return '';
}

// Render ì „ì²´ ë°©ì†¡
function renderAll(){
  const q=document.getElementById('searchAll').value.toLowerCase();
  let list=D;
  if(curTab==='livevod') list=D.filter(v=>v.type==='LIVE VOD');
  else if(curTab==='vod') list=D.filter(v=>v.type==='VOD');
  else if(curTab==='live') list=D.filter(v=>v.type==='LIVE');
  if(q) list=list.filter(v=>v.bc.toLowerCase().includes(q)||v.title.toLowerCase().includes(q)||v.id.includes(q));
  const sp=showPermCol();
  document.getElementById('allHead').innerHTML=`<th>âˆ¨</th><th>ê¸°ëŠ¥</th><th>ë°©ì†¡ë²ˆí˜¸/ì½”ë“œ</th><th>ë°©ì†¡ì</th><th>ë‹´ë‹¹MD</th><th>êµ¬ë¶„</th><th>ìƒíƒœ</th>${sp?'<th style="min-width:100px;">ì˜êµ¬ì €ì¥</th>':''}<th>ì œëª©</th><th>ê³µê°œ ì¼ì‹œ</th>`;
  document.getElementById('tbAll').innerHTML=list.map(v=>{
    const tb=getTypeBadge(v.type);
    const permCell=sp?(v.perm
      ?`<td><span class="perm-btn saved" onclick="clickPerm('${v.id}')">ğŸ”’ ì˜êµ¬ì €ì¥</span>${v.permId?'<br><span class="perm-id-badge">'+v.permId+'</span>':''}</td>`
      :`<td><span class="perm-btn normal" onclick="clickPerm('${v.id}')">ì¼ë°˜</span></td>`):'';
    return `<tr${v.perm&&sp?' style="background:#F5F7FF;"':''}>
      <td>âˆ¨</td><td style="color:#aaa;">Â·Â·Â·</td>
      <td><b>${v.id}</b><br><span class="text-muted">${v.code}</span></td>
      <td>${v.bc}<br><span class="text-muted">íŒë§¤ì</span></td>
      <td>${v.md||'<span class="text-muted">-</span>'}</td>
      <td><span class="badge ${tb}">${v.type}</span></td>
      <td><span class="badge badge-public">${v.st}</span></td>
      ${permCell}
      <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${v.title}</td>
      <td class="text-muted">${v.date}</td>
    </tr>`;
  }).join('');
}

function clickPerm(id){
  const v=D.find(x=>x.id===id);actionTarget=v;
  if(!v.perm){
    document.getElementById('mSetInfo').innerHTML=`<b>${v.id}</b> Â· ${v.bc}<br>${v.title}`;
    document.getElementById('mSet').classList.add('show');
  } else {
    document.getElementById('mUnsetInfo').innerHTML=`<b>${v.id}</b> Â· ${v.bc}<br>${v.title}${v.permId?'<br><span style="font-size:10px;color:#4F46E5;">ì˜êµ¬ì €ì¥ ID: '+v.permId+'</span>':''}`;
    document.getElementById('mUnset').classList.add('show');
  }
}

function confirmSet(){
  if(!actionTarget) return;
  actionTarget.perm=true;
  actionTarget.permDate=new Date().toISOString().slice(0,16).replace('T',' ');
  closeM('mSet'); renderAll();
  toast('âœ… ì˜êµ¬ì €ì¥ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function confirmUnset(){
  if(!actionTarget) return;
  actionTarget.perm=false; actionTarget.permId=null; actionTarget.permDate=null;
  closeM('mUnset'); renderAll();
  toast('ğŸ”“ ì˜êµ¬ì €ì¥ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤. 6ê°œì›” í›„ ì„œë¹„ìŠ¤ ë…¸ì¶œì´ ì¢…ë£Œë©ë‹ˆë‹¤.');
}

// === ID ê¸°ë°˜ ì˜êµ¬ì €ì¥ ===
function setPermById(){
  const pid=document.getElementById('permIdInput').value.trim();
  if(!pid){toast('âŒ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const targets=D.filter(v=>v.sellerId===pid&&!v.perm);
  const already=D.filter(v=>v.sellerId===pid&&v.perm);
  pendingPermId=pid;
  document.getElementById('mIdSetInfo').innerHTML=`<b>ID:</b> ${pid}`;
  document.getElementById('mIdSetResult').innerHTML=`ğŸ“Š ëŒ€ìƒ í˜„í™©<br>Â· ì‹ ê·œ ì˜êµ¬ì €ì¥: <b>${targets.length}ê±´</b> (LIVE VOD, VOD, ì‡¼ì¸ )<br>Â· ì´ë¯¸ ì˜êµ¬ì €ì¥: ${already.length}ê±´<br>Â· ì „ì²´: ${targets.length+already.length}ê±´`;
  if(targets.length===0&&already.length===0){
    document.getElementById('mIdSetResult').innerHTML=`âš ï¸ í•´ë‹¹ IDë¡œ ë“±ë¡ëœ VODê°€ ì—†ìŠµë‹ˆë‹¤. IDë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`;
  }
  document.getElementById('mIdSet').classList.add('show');
}

function confirmIdSet(){
  const pid=pendingPermId;
  const now=new Date().toISOString().slice(0,16).replace('T',' ');
  D.filter(v=>v.sellerId===pid).forEach(v=>{v.perm=true;v.permId=pid;v.permDate=now;});
  if(!registeredPermIds.includes(pid)) registeredPermIds.push(pid);
  closeM('mIdSet');
  renderAll();renderPerm();updStats();renderRegisteredIds();updPermIdFilter();
  document.getElementById('permIdInput').value='';
  toast(`âœ… ${pid} ì˜ ëª¨ë“  VODê°€ ì˜êµ¬ì €ì¥ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

function unsetPermById(){
  const pid=document.getElementById('permIdInput').value.trim();
  if(!pid){toast('âŒ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const targets=D.filter(v=>v.permId===pid&&v.perm);
  if(targets.length===0){toast('âŒ í•´ë‹¹ IDë¡œ ì˜êµ¬ì €ì¥ëœ VODê°€ ì—†ìŠµë‹ˆë‹¤.');return;}
  pendingPermId=pid;
  document.getElementById('mIdUnsetInfo').innerHTML=`<b>ID:</b> ${pid}<br>í•´ì œ ëŒ€ìƒ: <b>${targets.length}ê±´</b>`;
  document.getElementById('mIdUnset').classList.add('show');
}

function confirmIdUnset(){
  const pid=pendingPermId;
  D.filter(v=>v.permId===pid).forEach(v=>{v.perm=false;v.permId=null;v.permDate=null;});
  registeredPermIds=registeredPermIds.filter(x=>x!==pid);
  closeM('mIdUnset');
  renderAll();renderPerm();updStats();renderRegisteredIds();updPermIdFilter();
  document.getElementById('permIdInput').value='';
  toast(`ğŸ”“ ${pid} ì˜ ëª¨ë“  VOD ì˜êµ¬ì €ì¥ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

function renderRegisteredIds(){
  const el=document.getElementById('registeredIds');
  if(registeredPermIds.length===0){el.innerHTML='';return;}
  el.innerHTML=`<div style="font-size:10px;color:#666;font-weight:600;margin-bottom:6px;">ë“±ë¡ëœ ì˜êµ¬ì €ì¥ ID (${registeredPermIds.length}ê°œ)</div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;">${registeredPermIds.map(pid=>{
      const cnt=D.filter(v=>v.permId===pid&&v.perm).length;
      return `<span style="display:inline-flex;align-items:center;gap:6px;background:#EEF2FF;border:1px solid #C7D2FE;padding:4px 10px;border-radius:5px;font-size:11px;">
        <b style="color:#4F46E5;font-family:monospace;">${pid}</b>
        <span style="color:#888;">${cnt}ê±´</span>
      </span>`;
    }).join('')}</div>`;
}

function updPermIdFilter(){
  const sel=document.getElementById('permIdFilter');
  const cur=sel.value;
  const ids=[...new Set(D.filter(v=>v.perm&&v.permId).map(v=>v.permId))];
  sel.innerHTML='<option value="all">ì „ì²´ ID</option>'+ids.map(id=>`<option value="${id}" ${id===cur?'selected':''}>${id} (${D.filter(v=>v.permId===id&&v.perm).length}ê±´)</option>`).join('');
}

// Render ì˜êµ¬ì €ì¥ ëª©ë¡
function renderPerm(){
  const q=document.getElementById('searchPerm').value.toLowerCase();
  const pidF=document.getElementById('permIdFilter').value;
  const typeF=document.getElementById('permTypeFilter').value;
  let list=D.filter(v=>v.perm);
  if(pidF!=='all') list=list.filter(v=>v.permId===pidF);
  if(typeF!=='all') list=list.filter(v=>v.type===typeF);
  if(q) list=list.filter(v=>v.bc.toLowerCase().includes(q)||v.title.toLowerCase().includes(q)||v.id.includes(q));
  if(!list.length){
    document.getElementById('tbPerm').innerHTML='<tr><td colspan="10" class="empty">ğŸ“­ ì˜êµ¬ì €ì¥ëœ VODê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';return;
  }
  document.getElementById('tbPerm').innerHTML=list.map(v=>{
    const tb=getTypeBadge(v.type);
    return `<tr>
      <td><input type="checkbox" class="chk" data-id="${v.id}" ${permChecked.has(v.id)?'checked':''} onchange="tglPerm(this)"></td>
      <td><span class="perm-id-badge">${v.permId||'-'}</span></td>
      <td><b>${v.id}</b></td>
      <td>${v.bc}</td>
      <td>${v.md||'-'}</td>
      <td><span class="badge ${tb}">${v.type}</span></td>
      <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${v.title}</td>
      <td class="text-muted">${v.permDate}</td>
      <td class="text-muted">${v.date}</td>
      <td><button class="btn btn-danger btn-sm" onclick="clickPerm('${v.id}')">í•´ì œ</button></td>
    </tr>`;
  }).join('');
}

function tglPerm(el){if(el.checked)permChecked.add(el.dataset.id);else permChecked.delete(el.dataset.id);}
function togglePermAll(el){document.querySelectorAll('#tbPerm .chk').forEach(c=>{c.checked=el.checked;if(el.checked)permChecked.add(c.dataset.id);else permChecked.delete(c.dataset.id);});}

function bulkRelease(){
  if(!permChecked.size){toast('âŒ í•´ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
  permChecked.forEach(id=>{const v=D.find(x=>x.id===id);if(v){v.perm=false;v.permId=null;v.permDate=null;}});
  permChecked.clear();document.getElementById('ckAllPerm').checked=false;
  renderPerm();updStats();updPermIdFilter();renderRegisteredIds();
  toast('ğŸ”“ ì„ íƒí•œ VODì˜ ì˜êµ¬ì €ì¥ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function updStats(){
  const p=D.filter(v=>v.perm);
  const ids=[...new Set(p.map(v=>v.permId).filter(Boolean))];
  document.getElementById('stCnt').innerHTML=p.length+'<span class="unit">ê±´</span>';
  document.getElementById('stIdCnt').innerHTML=ids.length+'<span class="unit">ê°œ</span>';
  document.getElementById('stRatio').innerHTML=Math.round(p.length/D.length*100)+'<span class="unit">%</span>';
}

function closeM(id){document.getElementById(id).classList.remove('show');actionTarget=null;}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}

renderAll();
</script>
</body>
</html>
